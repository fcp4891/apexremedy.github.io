# Inventario Front Público (09-11-2025)

## Resumen de stack
- **Entrega actual:** HTML estático servido desde `frontend/`, sin bundler (scripts y estilos enlazados directamente).
- **CSS global:** `style/css_home.css` reúne tokens, layout principal, componentes reutilizados y overrides responsivos.
- **CSS por vista:** archivos dedicados (`style/index.css`, `style/tienda.css`, etc.) mezclan reglas de página con estilos cross-page.
- **JS compartido:** módulos globales en `js/` expuestos vía `window` (`basePath.js`, `config.js`, `utils.js`, `template.js`, `sessionManager.js`, `auth.js`, `notifications.js`, `api/apiClient.js`).
- **Componentes HTML:** fragmentos en `components/*.html` (header, footer, formularios) cargados dinámicamente por `template.js`.
- **Dependencias CDN:** `tailwindcss` y `font-awesome` inyectados en casi todas las vistas; Tailwind usa `tailwind.config.js` local solo para safelist manual.

## Mapa de dependencias (HTML → CSS/JS)

| Vista | CSS cargado | JS cargado (orden declarativo) |
| --- | --- | --- |
| `index.html` | `style/css_home.css`, `style/index.css` | `env-detector`, `config`, `utils`, `template` |
| `tienda.html` | `style/css_home.css`, `style/tienda.css` | `basePath`, `config`, `utils`, `template` |
| `productos.html` | `style/css_home.css`, `style/tienda.css`, `style/catalogo.css` | `basePath`, `config`, `utils`, `template`, `api/apiClient`, `auth`, `notifications`, `productModal`, inline catálogo |
| `catalogo/index.html` | `catalogo/styles.css`, `catalogo/product-manager-styles.css` | `catalogo/data`, `catalogo/catalog-api`, `catalogo/integration`, `catalogo/product-manager`, `catalogo/visual-editor`, `catalogo/script` |
| `carrito.html` | `style/css_home.css` | `basePath`, `config`, `utils`, `template`, `api/apiClient`, `auth`, `notifications`, `carrito` |
| `checkout.html` | `style/css_home.css`, `style/checkout.css` | `basePath`, `config`, `utils`, `template`, `api/apiClient`, `auth`, `notifications`, `checkout` |
| `mis-pedidos.html` | `style/css_home.css`, `style/mis-pedidos.css` | `basePath`, `config`, `utils`, `template`, `api/apiClient`, `auth`, `notifications` |
| `perfil.html` | `style/css_home.css`, `style/perfil.css` | `basePath`, `config`, `utils`, `template`, `api/apiClient`, `auth`, `notifications`, inline UI |
| `login.html` | `style/css_home.css`, `style/login.css` | `basePath`, `config`, `utils`, `template`, `api/apiClient`, `auth`, `notifications` |
| `registro.html` | `style/css_home.css`, `style/registro.css` | `basePath`, `config`, `utils`, `template`, `api/apiClient`, `auth`, `notifications` |
| `nosotros.html` | `style/css_home.css`, `style/nosotros.css` | `basePath`, `config`, `utils`, `template` |
| `marco-legal.html` | `style/css_home.css`, `style/marco-legal.css` | `basePath`, `config`, `utils`, `template` |
| `contacto.html` | `style/css_home.css`, `style/contacto.css` | `basePath`, `config`, `utils`, `template`, `notifications` |
| `productos.html` (sección carrito embebido) | `style/css_home.css`, `style/mis-pedidos.css` | reutiliza `cart` y `template` |
| `poder_cultivo_firma_simple.html` | `style/css_home.css`, inline CSS | `basePath`, `config`, `utils`, `template`, scripts específicos de firma |
| `mapa_calor_cantiago/*.html` | CSS y JS propios en `mapa_calor_cantiago/` + `style/css_home.css` | `leaflet`, `echarts`, scripts locales (`geo-data.js`, `heatmap.js`, etc.) |

> Rutas en `frontend/admin/` excluidas del alcance actual.

## Dependencias JS compartidas

- `basePath.js`: establece `window.BASE_PATH` para rutas dinámicas (GitHub Pages); usado por `template.js` y redirecciones.
- `config.js`: configura `window.APP_CONFIG` (endpoints, toggles); consumido por `template`, `carrito`, `checkout`, `auth`.
- `utils.js`: expone `window.Utils`; contiene helpers genéricos (formateos, validador RUT, debounce/throttle, toasts personalizados).
- `template.js`: inyecta header/footer (`components/*.html`), maneja menú móvil, carrito sidebar, estado auth UI.
- `auth.js`: crea `window.authManager`, dependiente de `api/apiClient` y `Utils`.
- `sessionManager.js`: controla expiración y sincronización de sesión (`localStorage`), escucha eventos de `authManager`.
- `notifications.js`: provee `window.notify` con diálogos modales (SweetAlert-like) y toasts.
- `api/apiClient.js`: fetch wrapper contra API backend (`/api/*`), maneja token y errores; usado por `auth`, `carrito`, `checkout`, `productos`.
- `carrito.js`, `checkout.js`, `productModal.js`, `admin-products.js`: lógica específica de vistas, mezcla operaciones DOM y llamadas API.

## Patrón de componentes / templates

- `components/header*.html` y `components/footer*.html` cargados por `template.js`; contienen estilos inline (`style` attributes) y dependencias de iconos.
- Formularios especializados (`components/poder-cultivo-form.html`) reutilizados en `poder_cultivo/`.
- Carrito lateral (`components/header.html`) requiere clases `cart-sidebar`, `cart-overlay` definidas en CSS global.

## Uso de CSS

- `style/css_home.css` combina:
  - Reset básico y tipografías.
  - Tokens de color/espaciado declarados como variables CSS (`--primary-green`, etc.), pero dispersos.
  - Componentes (`.cta-button`, `.hero`, `.navbar`, `.cart-sidebar`, `.card-icon`).
  - Utilidades improvisadas (`.text-center`, `.flex-between`).
  - Media queries profundas e inline (`@media` con overrides específicos).
- Archivos por vista repiten patrones (`.section-header`, `.container`, `.cta-button`) ya definidos en `css_home.css`.
- `style` contiene submódulo npm (no usado en build actual) con Tailwind preset (`style/node_modules`, `tailwind.config.js`) → deuda histórica.
- `catalogo/*.css` define un tema independiente para el gestor de catálogo.
- Inline styles abundantes en HTML (especialmente `index`, `tienda`, `carrito`) duplican valores de `css_home.css`.

## Observaciones clave

- **Duplicidad JS:** `products.html`, `carrito.html`, `checkout.html` reimplementan renderizado de tarjetas y lógica de carrito; `carrito.js` y `productModal.js` comparten helpers no centralizados.
- **Eventos/globales:** Todos los scripts dependen de `window` y `document` directamente; no hay módulo central para eventos o estado global.
- **Selectores CSS:** Prefijos mezclados (`.hero`, `.shop-header`, `.registration-notice-section`), sin convención (BEM vs utilidades). Algunas clases no aparecen en HTML (`.gradient-pill`, `.modal-backdrop`).
- **Assets:** Imágenes en `frontend/images/` sin organización por vista; algunas duplicadas (`hero-bg.png` vs `portada*.png`).
- **Tailwind:** CDN se usa solo para utilidades sueltas; configuración `tailwind.config.js` define safelist manual, pero no hay build ni purge automático.
- **Documentación:** `AVANCES.md`, `CAMBIOS_EXACTOS.md` registran cambios ad-hoc; `CHANGES.md` menciona tareas previas del admin pero no cubre frontend público.

## Próximos pasos sugeridos (para RFC)

1. Definir convención CSS orientada a **BEM + utilidades limitadas**; mover tokens a `styles/tokens.css`.
2. Crear estructura objetivo `frontend/src/`:
   - `styles/{tokens,base,utilities,components}.css`
   - `views/{vista}/{vista}.{html,css,js}`
   - `lib/{apiClient.js,auth.js,session.js,utils.js,template.js,cart.js}`
3. Identificar funciones duplicadas (`cart.*`, render cards) y preparar módulo común (`lib/cartService.js`, `lib/productCatalog.js`).
4. Auditar selectores con script (`postcss-selector-parser` + `rg`) para detectar no usados antes de purgar.
5. Planificar migración de assets (optimizar PNG a WebP donde aplique).
6. Documentar en `CHANGES.md` la lista de candidatos a eliminar y dependencias críticas (data atributos, clases usadas por tests).



