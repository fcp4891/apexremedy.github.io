<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Pagos - Apexremedy Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style/css_admin.css">
    <link rel="stylesheet" href="style/payments.css">
    <script src="./js/basePath.js"></script>
    <script src="./js/config.js"></script>
    <script src="./js/utils.js"></script>
    <script type="module" src="./js/adminTemplate.legacy.js"></script>
    <script src="./js/notifications.js"></script>
    <script src="./js/api/apiClient.js"></script>
    <script src="./js/auth.js"></script>
    <script defer src="./js/adminTemplate.js"></script>
    <script defer src="./js/payments.js"></script>
    <script defer src="./js/paymentsCRUD.js"></script>
</head>
<body>
    <!-- Header se carga automáticamente -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header Section -->
        <div class="admin-page-header">
            <div>
                <h1 class="admin-page-title">Sistema de Pagos</h1>
                <p class="admin-page-subtitle">Gestiona pagos, reembolsos y gift cards</p>
            </div>
            <div class="admin-page-actions">
                <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="refresh-current-tab">
                    <i class="fas fa-sync-alt admin-btn__icon"></i>Actualizar
                </button>
            </div>
        </div>

        <!-- Estadísticas Generales -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Total Pagos</p>
                        <p id="statsTotalPayments" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-full">
                        <i class="fas fa-credit-card text-blue-600 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Pagados</p>
                        <p id="statsCapturedPayments" class="text-3xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-green-100 p-4 rounded-full">
                        <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Reembolsos</p>
                        <p id="statsTotalRefunds" class="text-3xl font-bold text-yellow-600">0</p>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-full">
                        <i class="fas fa-undo text-yellow-600 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Gift Cards</p>
                        <p id="statsGiftCards" class="text-3xl font-bold text-purple-600">0</p>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-full">
                        <i class="fas fa-gift text-purple-600 text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="mb-6 border-b border-gray-200 overflow-x-auto">
            <nav class="-mb-px flex space-x-2 min-w-max">
                <button id="tab-payments" class="tab-button active px-4 py-3 text-base font-semibold border-b-2 border-green-600 text-green-600 whitespace-nowrap" data-action="switch-tab" data-tab="payments">
                    <i class="fas fa-credit-card mr-2"></i>Pagos
                </button>
                <button id="tab-refunds" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="refunds">
                    <i class="fas fa-undo mr-2"></i>Reembolsos
                </button>
                <button id="tab-gift-cards" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="gift-cards">
                    <i class="fas fa-gift mr-2"></i>Gift Cards
                </button>
                <button id="tab-gift-card-transactions" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="gift-card-transactions">
                    <i class="fas fa-exchange-alt mr-2"></i>Transacciones GC
                </button>
                <button id="tab-refund-reasons" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover-border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="refund-reasons">
                    <i class="fas fa-list mr-2"></i>Motivos Reembolso
                </button>
                <button id="tab-gift-card-campaigns" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="gift-card-campaigns">
                    <i class="fas fa-bullhorn mr-2"></i>Campañas GC
                </button>
                <button id="tab-payment-methods" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover-border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="payment-methods">
                    <i class="fas fa-wallet mr-2"></i>Métodos Pago
                </button>
                <button id="tab-payment-providers" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover-border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="payment-providers">
                    <i class="fas fa-server mr-2"></i>Proveedores
                </button>
                <button id="tab-chargebacks" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover-border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="chargebacks">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Chargebacks
                </button>
                <button id="tab-settlements" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover-border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="settlements">
                    <i class="fas fa-file-invoice mr-2"></i>Conciliaciones
                </button>
                <button id="tab-webhooks" class="tab-button px-4 py-3 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover-border-gray-300 whitespace-nowrap" data-action="switch-tab" data-tab="webhooks">
                    <i class="fas fa-broadcast-tower mr-2"></i>Webhooks
                </button>
            </nav>
        </div>

        <!-- Tab Content Container -->
        <div id="payments-tab-content-container">
            <!-- Payments Tab -->
            <div id="content-payments" class="payments-tab-content">
                <!-- Filtros -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h3 class="font-bold text-gray-800 mb-4"><i class="fas fa-filter mr-2"></i>Filtros</h3>
                    <div class="grid md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
                            <select id="filterPaymentStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="">Todos</option>
                                <option value="authorized">Autorizado</option>
                                <option value="captured">Capturado</option>
                                <option value="failed">Fallido</option>
                                <option value="voided">Anulado</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Método</label>
                            <select id="filterPaymentMethod" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="">Todos</option>
                                <option value="Tarjeta de Crédito">Tarjeta Crédito</option>
                                <option value="Tarjeta de Débito">Tarjeta Débito</option>
                                <option value="Transferencia Bancaria">Transferencia</option>
                                <option value="Efectivo">Efectivo</option>
                                <option value="Gift Card">Gift Card</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Desde</label>
                            <input type="date" id="filterPaymentDateFrom" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hasta</label>
                            <input type="date" id="filterPaymentDateTo" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button class="admin-btn admin-btn--accent admin-btn--compact" data-action="apply-payment-filters">
                            <i class="fas fa-search admin-btn__icon"></i>Filtrar
                        </button>
                        <button class="admin-btn admin-btn--muted admin-btn--compact" data-action="clear-payment-filters">
                            <i class="fas fa-times admin-btn__icon"></i>Limpiar
                        </button>
                    </div>
                </div>

                <!-- Tabla de Pagos -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">ID</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Pedido</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Cliente</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Monto</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Método</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Estado</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Fecha</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTable" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="8" class="px-6 py-12 text-center">
                                        <i class="fas fa-spinner fa-spin text-4xl text-green-600"></i>
                                        <p class="text-gray-500 mt-2">Cargando pagos...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Refunds Tab -->
            <div id="content-refunds" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-undo mr-2"></i>Reembolsos</h3>
                    <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-refund">
                        <i class="fas fa-plus admin-btn__icon"></i>Nuevo Reembolso
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">ID</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Pago</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Monto</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Motivo</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Estado</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Fecha</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="refundsTable" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-6 py-12 text-center text-gray-500">Cargando reembolsos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gift Cards Tab -->
            <div id="content-gift-cards" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-gift mr-2"></i>Gift Cards</h3>
                        <div class="flex gap-2">
                            <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-gift-card">
                                <i class="fas fa-plus admin-btn__icon"></i>Nueva Gift Card
                            </button>
                            <button class="admin-btn admin-btn--accent admin-btn--compact" data-action="open-batch-gift-card">
                                <i class="fas fa-layer-group admin-btn__icon"></i>Crear en Lote
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Código</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Valor Inicial</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Saldo</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Estado</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Cliente</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Expira</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="giftCardsTable" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-6 py-12 text-center text-gray-500">Cargando gift cards...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Otras pestañas (simplificadas por espacio) -->
            <div id="content-gift-card-transactions" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="font-bold text-gray-800 mb-4"><i class="fas fa-exchange-alt mr-2"></i>Transacciones de Gift Cards</h3>
                    <div id="giftCardTransactionsTable" class="text-gray-500">Cargando transacciones...</div>
                </div>
            </div>

            <div id="content-refund-reasons" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-list mr-2"></i>Motivos de Reembolso</h3>
                        <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-refund-reason">
                            <i class="fas fa-plus admin-btn__icon"></i>Nuevo Motivo
                        </button>
                    </div>
                    <div id="refundReasonsTable" class="text-gray-500">Cargando motivos...</div>
                </div>
            </div>

            <div id="content-gift-card-campaigns" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-bullhorn mr-2"></i>Campañas de Gift Cards</h3>
                        <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-campaign">
                            <i class="fas fa-plus admin-btn__icon"></i>Nueva Campaña
                        </button>
                    </div>
                    <div id="campaignsTable" class="text-gray-500">Cargando campañas...</div>
                </div>
            </div>

            <div id="content-payment-methods" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-wallet mr-2"></i>Métodos de Pago</h3>
                        <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-payment-method">
                            <i class="fas fa-plus admin-btn__icon"></i>Nuevo Método
                        </button>
                    </div>
                    <div id="paymentMethodsTable" class="text-gray-500">Cargando métodos...</div>
                </div>
            </div>

            <div id="content-payment-providers" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-server mr-2"></i>Proveedores de Pago</h3>
                        <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-provider">
                            <i class="fas fa-plus admin-btn__icon"></i>Nuevo Proveedor
                        </button>
                    </div>
                    <div id="providersTable" class="text-gray-500">Cargando proveedores...</div>
                </div>
            </div>

            <div id="content-chargebacks" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-exclamation-triangle mr-2"></i>Chargebacks</h3>
                        <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-chargeback">
                            <i class="fas fa-plus admin-btn__icon"></i>Nuevo Chargeback
                        </button>
                    </div>
                    <div id="chargebacksTable" class="text-gray-500">Cargando chargebacks...</div>
                </div>
            </div>

            <div id="content-settlements" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800"><i class="fas fa-file-invoice mr-2"></i>Conciliaciones</h3>
                        <button class="admin-btn admin-btn--primary admin-btn--compact" data-action="open-create-settlement">
                            <i class="fas fa-plus admin-btn__icon"></i>Nueva Conciliación
                        </button>
                    </div>
                    <div id="settlementsTable" class="text-gray-500">Cargando conciliaciones...</div>
                </div>
            </div>

            <div id="content-webhooks" class="payments-tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="font-bold text-gray-800 mb-4"><i class="fas fa-broadcast-tower mr-2"></i>Entregas de Webhooks</h3>
                    <div id="webhooksTable" class="text-gray-500">Cargando webhooks...</div>
                </div>
            </div>
        </div>
    </div>
    <script src="./js/payments-page.js" defer></script>
</body>
</html>

